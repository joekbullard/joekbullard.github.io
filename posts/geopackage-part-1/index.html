<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>GeoPackage and Python - Part 1 | Joe k Bullard</title><meta name=keywords content="python,geopackage"><meta name=description content="GeoPackage (GPKG) is a spatial format that many QGIS users will be familiar with, as a format it offers many advantages over the ubiquitous shapefile format. In short, the Geopackage Encoding Standard enforces a set of rules and standards for storing vector features (Points, Lines, Polygons) and raster data in an SQLite database. While many people will use GPKG as a like-for-like shapefile replacement, through knowledge of some fairly basic SQL it can offer some of the advanced functionality typically associated with spatial databases such as PostgreSQL/PostGIS."><meta name=author content="Me"><link rel=canonical href=https://joekbullard.github.io/posts/geopackage-part-1/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.89903f5336eff9763209fb4cd1e860a14715773bf5fd93b39c714e2690162751.css integrity="sha256-iZA/Uzbv+XYyCftM0ehgoUcVdzv1/ZOznHFOJpAWJ1E=" rel="preload stylesheet" as=style><link rel=icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="GeoPackage and Python - Part 1"><meta property="og:description" content="GeoPackage (GPKG) is a spatial format that many QGIS users will be familiar with, as a format it offers many advantages over the ubiquitous shapefile format. In short, the Geopackage Encoding Standard enforces a set of rules and standards for storing vector features (Points, Lines, Polygons) and raster data in an SQLite database. While many people will use GPKG as a like-for-like shapefile replacement, through knowledge of some fairly basic SQL it can offer some of the advanced functionality typically associated with spatial databases such as PostgreSQL/PostGIS."><meta property="og:type" content="article"><meta property="og:url" content="https://joekbullard.github.io/posts/geopackage-part-1/"><meta property="og:image" content="https://joekbullard.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-20T19:39:57+00:00"><meta property="article:modified_time" content="2023-03-20T19:39:57+00:00"><meta property="og:site_name" content="JoeKBullrd"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://joekbullard.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="GeoPackage and Python - Part 1"><meta name=twitter:description content="GeoPackage (GPKG) is a spatial format that many QGIS users will be familiar with, as a format it offers many advantages over the ubiquitous shapefile format. In short, the Geopackage Encoding Standard enforces a set of rules and standards for storing vector features (Points, Lines, Polygons) and raster data in an SQLite database. While many people will use GPKG as a like-for-like shapefile replacement, through knowledge of some fairly basic SQL it can offer some of the advanced functionality typically associated with spatial databases such as PostgreSQL/PostGIS."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://joekbullard.github.io/posts/"},{"@type":"ListItem","position":3,"name":"GeoPackage and Python - Part 1","item":"https://joekbullard.github.io/posts/geopackage-part-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"GeoPackage and Python - Part 1","name":"GeoPackage and Python - Part 1","description":"GeoPackage (GPKG) is a spatial format that many QGIS users will be familiar with, as a format it offers many advantages over the ubiquitous shapefile format. In short, the Geopackage Encoding Standard enforces a set of rules and standards for storing vector features (Points, Lines, Polygons) and raster data in an SQLite database. While many people will use GPKG as a like-for-like shapefile replacement, through knowledge of some fairly basic SQL it can offer some of the advanced functionality typically associated with spatial databases such as PostgreSQL/PostGIS.","keywords":["python","geopackage"],"articleBody":"GeoPackage (GPKG) is a spatial format that many QGIS users will be familiar with, as a format it offers many advantages over the ubiquitous shapefile format. In short, the Geopackage Encoding Standard enforces a set of rules and standards for storing vector features (Points, Lines, Polygons) and raster data in an SQLite database. While many people will use GPKG as a like-for-like shapefile replacement, through knowledge of some fairly basic SQL it can offer some of the advanced functionality typically associated with spatial databases such as PostgreSQL/PostGIS. In this post, I will go through some of the requirements of the format specification and how you can create and interact with a geopackage using python\nRequirements Python Virtual environment manager - I will be using poetry QGIS Setting up a virtual environment Before starting, we will need to set up a development environment. If you’re using poetry, you can do so in the following way:\n$ poetry new py-gpkg Next we will install the python gdal bindings:\n$ poetry add GDAL Now we are good to go\nCreating a blank geopackage There are a number of ways to create a geopackage, you can use QGIS or download an empty geopackage. In this tutorial we will be using python and the GDAL and SQLite libraries. To start off with, we will use GDAL to create a blank geopackage. Create a blank python file called create_gpkg.py and add the following:\nNote - for those unfamiliar with the python GDAL bindings, it has a few quirks that may catch you out, it also uses camel case.\nimport os from osgeo import ogr driver = \"GPKG\" filename = \"generated.gpkg\" driver = ogr.GetDriverByName(driver) if os.path.exists(filename): driver.DeleteDataSource(filename) data_source = driver.CreateDataSource(filename) data_source = None If you run the above file using poetry run python create_gpkg.py it should create an empty geopackage called generated.gpkg\nA brief word on the GeoPackage specification Before we go any further, it’s worth taking a moment to understand a few bits about the OGC GeoPackage standard - more specifically - the mandatory metadata tables gpkg_contents and gpkg_spatial_ref_sys. In addition to the two mandatory tables, there’s also one non-mandatory table that’s worth knowing about - gpkg_geometry_columns. All three of these are summarised below.\ngpkg_contents This table does more or less what you would expect given the name, it’s a contents table for a given GeoPackage that lists all geometry tables. A full specification can be seen on the table definition on geopackage.org\ngpkg_spatial_ref_sys Much like gpkg_contents, I’m sure you can hazard a guess as to what you this table contains. If you guessed coordinate/spatial reference systems, then well done. Note that by default this table contains 3 rows - 4326, -1 for undefined Cartesian CRS’s and 0 for undefined geographic CRS’s, if you wish to work with a CRS other than 4326 then you will need to add it to this table.\ngpkg_geometry_columns Lastly - gpkg_geometry_columns contains metadata relating to the geometry column for a given spatial table - including geometry type and CRS.\nDefining tables using sqlite3 Now let’s connect to the GeoPackage and start creating some tables. Python has a built in library for interacting with SQLite databases - sqlite3.\nTo connect to the GeoPackage we just made:\nimport sqlite3 conn = sqlite3.connect('generated.gpkg') Now for the purpose of this topic, let’s make two simple geometry tables, point and polygon. We will be working with EPSG:2770 for no reason other than it’s the CRS I use most frequently myself. Following on from above, run the code below.\nfrom pyproj import CRS srs_name = \"OSGB36 / British National Grid\" srs_id = 27700 srs_org = \"EPSG\" srs_org_id = 27700 srs_def = CRS.from_epsg(27700).to_wkt() srs_desc = \"Easting / northing, units in meters\" cursor = conn.cursor() cursor.execute('insert into gpkg_spatial_ref_sys VALUES (?, ?, ?, ?, ?, ?)', (srs_name, srs_id, srs_org, srs_org_id, srs_def, srs_desc)) # insert values into gpkg_spatial_ref_sys cursor.execute( \"insert into gpkg_spatial_ref_sys VALUES (?, ?, ?, ?, ?, ?)\", (srs_name, srs_id, srs_org, srs_org_id, srs_def, srs_desc), ) # create tables and trigger cursor.executescript( \"\"\" CREATE TABLE 'point' ( id INTEGER PRIMARY KEY AUTOINCREMENT, geom POINT NOT NULL, name TEXT NOT NULL, buffer INTEGER NOT NULL ); CREATE TABLE 'poly' ( id INTEGER PRIMARY KEY AUTOINCREMENT, geom POLYGON NOT NULL, point_id INTEGER, FOREIGN KEY(point_id) REFERENCES point(id) ); \"\"\" ) # insert values into gpkg_contents tables cursor.execute( \"\"\" insert into gpkg_contents(table_name, data_type, identifier, srs_id) values ('point','features','point',27700), ('poly','features', 'poly', 27700); \"\"\" ) # insert values into gpkg_geometry_column tables cursor.execute( \"\"\" insert into gpkg_geometry_columns values ('point','geom','POINT', 27700, 0, 0 ), ('poly','geom','POLYGON',27700, 0, 0 ) \"\"\" ) # commit changes conn.commit() Let’s run over what we’ve just done. The first few lines set out the mandatory fields required for the gpkg_spatial_ref_sys table to insert a row for EPSG:27700, we then create a cursor object using the previously used connection to the geopackage and insert the row into the gpkg_spatial_ref_sys table.\nNext up, we create two tables, point and poly uing executescript method - be sure to take a look at the constraints and types used. After that we insert entries for both tables into gpkg_contents and gpkg_geometry_columns metadata tables before commiting the changes to the database using commit. You should now be able to add the geopackage to QGIS and both point and poly will be recognised as valid layers.\nThat’s it for part 1, next up we will go into some more advanced functionality, including triggers to automate logic with SQL that would otherwise be handled by scripting or using QGIS processing tools.\n","wordCount":"908","inLanguage":"en","datePublished":"2023-03-20T19:39:57Z","dateModified":"2023-03-20T19:39:57Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://joekbullard.github.io/posts/geopackage-part-1/"},"publisher":{"@type":"Organization","name":"Joe k Bullard","logo":{"@type":"ImageObject","url":"https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://joekbullard.github.io accesskey=h title="Home (Alt + H)"><img src=https://joekbullard.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://joekbullard.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://joekbullard.xyz title=joekbullard.xyz><span>joekbullard.xyz</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://joekbullard.github.io>Home</a>&nbsp;»&nbsp;<a href=https://joekbullard.github.io/posts/>Posts</a></div><h1 class=post-title>GeoPackage and Python - Part 1</h1><div class=post-meta><span title='2023-03-20 19:39:57 +0000 UTC'>March 20, 2023</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;908 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/geopackage-part-1.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>GeoPackage (GPKG) is a spatial format that many QGIS users will be familiar with, as a format it offers <a href=http://switchfromshapefile.org/#geopackage>many advantages</a> over the ubiquitous shapefile format. In short, the Geopackage Encoding Standard enforces a set of rules and standards for storing vector features (Points, Lines, Polygons) and raster data in an SQLite database. While many people will use GPKG as a like-for-like shapefile replacement, through knowledge of some fairly basic SQL it can offer some of the advanced functionality typically associated with spatial databases such as PostgreSQL/PostGIS. In this post, I will go through some of the requirements of the format specification and how you can create and interact with a geopackage using python</p><h2 id=requirements>Requirements<a hidden class=anchor aria-hidden=true href=#requirements>#</a></h2><ul><li>Python</li><li>Virtual environment manager - I will be using <a href=https://python-poetry.org/>poetry</a></li><li>QGIS</li></ul><h2 id=setting-up-a-virtual-environment>Setting up a virtual environment<a hidden class=anchor aria-hidden=true href=#setting-up-a-virtual-environment>#</a></h2><p>Before starting, we will need to set up a development environment. If you&rsquo;re using poetry, you can do so in the following way:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ poetry new py-gpkg
</span></span></code></pre></div><p>Next we will install the python gdal bindings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ poetry add GDAL
</span></span></code></pre></div><p>Now we are good to go</p><h2 id=creating-a-blank-geopackage>Creating a blank geopackage<a hidden class=anchor aria-hidden=true href=#creating-a-blank-geopackage>#</a></h2><p>There are a number of ways to create a geopackage, you can use QGIS or download an <a href=http://www.geopackage.org/data/empty.gpkg>empty geopackage</a>. In this tutorial we will be using python and the GDAL and SQLite libraries. To start off with, we will use GDAL to create a blank geopackage. Create a blank python file called <code>create_gpkg.py</code> and add the following:</p><p><strong>Note</strong> - for those unfamiliar with the python GDAL bindings, it has a few quirks that may catch you out, it also uses camel case.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>osgeo</span> <span class=kn>import</span> <span class=n>ogr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>driver</span> <span class=o>=</span> <span class=s2>&#34;GPKG&#34;</span>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s2>&#34;generated.gpkg&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>driver</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>GetDriverByName</span><span class=p>(</span><span class=n>driver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>filename</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>driver</span><span class=o>.</span><span class=n>DeleteDataSource</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>CreateDataSource</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></div><p>If you run the above file using <code>poetry run python create_gpkg.py</code> it should create an empty geopackage called <code>generated.gpkg</code></p><h2 id=a-brief-word-on-the-geopackage-specification>A brief word on the GeoPackage specification<a hidden class=anchor aria-hidden=true href=#a-brief-word-on-the-geopackage-specification>#</a></h2><p>Before we go any further, it&rsquo;s worth taking a moment to understand a few bits about the OGC GeoPackage standard - more specifically - the mandatory metadata tables <a href=http://www.geopackage.org/spec120/#_contents><code>gpkg_contents</code></a> and <a href=http://www.geopackage.org/spec120/#spatial_ref_sys><code>gpkg_spatial_ref_sys</code></a>. In addition to the two mandatory tables, there&rsquo;s also one non-mandatory table that&rsquo;s worth knowing about - <code>gpkg_geometry_columns</code>. All three of these are summarised below.</p><h3 id=gpkg_contents><code>gpkg_contents</code><a hidden class=anchor aria-hidden=true href=#gpkg_contents>#</a></h3><p>This table does more or less what you would expect given the name, it&rsquo;s a contents table for a given GeoPackage that lists all geometry tables. A full specification can be seen on the <a href=http://www.geopackage.org/spec120/#_contents>table definition on geopackage.org</a></p><h3 id=gpkg_spatial_ref_sys><code>gpkg_spatial_ref_sys</code><a hidden class=anchor aria-hidden=true href=#gpkg_spatial_ref_sys>#</a></h3><p>Much like <code>gpkg_contents</code>, I&rsquo;m sure you can hazard a guess as to what you this table contains. If you guessed coordinate/spatial reference systems, then well done. Note that by default this table contains 3 rows - 4326, -1 for undefined Cartesian CRS&rsquo;s and 0 for undefined geographic CRS&rsquo;s, if you wish to work with a CRS other than 4326 then you will need to add it to this table.</p><h3 id=gpkg_geometry_columns><code>gpkg_geometry_columns</code><a hidden class=anchor aria-hidden=true href=#gpkg_geometry_columns>#</a></h3><p>Lastly - <code>gpkg_geometry_columns</code> contains metadata relating to the geometry column for a given spatial table - including geometry type and CRS.</p><h2 id=defining-tables-using-sqlite3>Defining tables using <code>sqlite3</code><a hidden class=anchor aria-hidden=true href=#defining-tables-using-sqlite3>#</a></h2><p>Now let&rsquo;s connect to the GeoPackage and start creating some tables. Python has a built in library for interacting with SQLite databases - <a href=https://docs.python.org/3/library/sqlite3.html>sqlite3</a>.</p><p>To connect to the GeoPackage we just made:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sqlite3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>&#39;generated.gpkg&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>Now for the purpose of this topic, let&rsquo;s make two simple geometry tables, <code>point</code> and <code>polygon</code>. We will be working with EPSG:2770 for no reason other than it&rsquo;s the CRS I use most frequently myself. Following on from above, run the code below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyproj</span> <span class=kn>import</span> <span class=n>CRS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>srs_name</span> <span class=o>=</span> <span class=s2>&#34;OSGB36 / British National Grid&#34;</span>
</span></span><span class=line><span class=cl><span class=n>srs_id</span> <span class=o>=</span> <span class=mi>27700</span>
</span></span><span class=line><span class=cl><span class=n>srs_org</span> <span class=o>=</span> <span class=s2>&#34;EPSG&#34;</span>
</span></span><span class=line><span class=cl><span class=n>srs_org_id</span> <span class=o>=</span> <span class=mi>27700</span>
</span></span><span class=line><span class=cl><span class=n>srs_def</span> <span class=o>=</span> <span class=n>CRS</span><span class=o>.</span><span class=n>from_epsg</span><span class=p>(</span><span class=mi>27700</span><span class=p>)</span><span class=o>.</span><span class=n>to_wkt</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>srs_desc</span> <span class=o>=</span> <span class=s2>&#34;Easting / northing, units in meters&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>&#39;insert into gpkg_spatial_ref_sys VALUES (?, ?, ?, ?, ?, ?)&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>srs_name</span><span class=p>,</span> <span class=n>srs_id</span><span class=p>,</span> <span class=n>srs_org</span><span class=p>,</span> <span class=n>srs_org_id</span><span class=p>,</span> <span class=n>srs_def</span><span class=p>,</span> <span class=n>srs_desc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># insert values into gpkg_spatial_ref_sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;insert into gpkg_spatial_ref_sys VALUES (?, ?, ?, ?, ?, ?)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>srs_name</span><span class=p>,</span> <span class=n>srs_id</span><span class=p>,</span> <span class=n>srs_org</span><span class=p>,</span> <span class=n>srs_org_id</span><span class=p>,</span> <span class=n>srs_def</span><span class=p>,</span> <span class=n>srs_desc</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create tables and trigger</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cursor</span><span class=o>.</span><span class=n>executescript</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    CREATE TABLE &#39;point&#39; (
</span></span></span><span class=line><span class=cl><span class=s2>    id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=s2>    geom POINT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>    name TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>    buffer INTEGER NOT NULL
</span></span></span><span class=line><span class=cl><span class=s2>    );
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    CREATE TABLE &#39;poly&#39; (
</span></span></span><span class=line><span class=cl><span class=s2>    id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=s2>    geom POLYGON NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>    point_id INTEGER,
</span></span></span><span class=line><span class=cl><span class=s2>    FOREIGN KEY(point_id) REFERENCES point(id)
</span></span></span><span class=line><span class=cl><span class=s2>    );
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># insert values into gpkg_contents tables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    insert into gpkg_contents(table_name, data_type, identifier, srs_id) values 
</span></span></span><span class=line><span class=cl><span class=s2>    (&#39;point&#39;,&#39;features&#39;,&#39;point&#39;,27700),
</span></span></span><span class=line><span class=cl><span class=s2>    (&#39;poly&#39;,&#39;features&#39;, &#39;poly&#39;, 27700);
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># insert values into gpkg_geometry_column tables</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    insert into gpkg_geometry_columns values 
</span></span></span><span class=line><span class=cl><span class=s2>    (&#39;point&#39;,&#39;geom&#39;,&#39;POINT&#39;, 27700, 0, 0 ),
</span></span></span><span class=line><span class=cl><span class=s2>    (&#39;poly&#39;,&#39;geom&#39;,&#39;POLYGON&#39;,27700, 0, 0 )
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># commit changes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span></code></pre></div><p>Let&rsquo;s run over what we&rsquo;ve just done. The first few lines set out the mandatory fields required for the <code>gpkg_spatial_ref_sys</code> table to insert a row for EPSG:27700, we then create a <code>cursor</code> object using the previously used connection to the geopackage and insert the row into the <code>gpkg_spatial_ref_sys</code> table.</p><p>Next up, we create two tables, <code>point</code> and <code>poly</code> uing <code>executescript</code> method - be sure to take a look at the constraints and types used. After that we insert entries for both tables into <code>gpkg_contents</code> and <code>gpkg_geometry_columns</code> metadata tables before commiting the changes to the database using <code>commit</code>. You should now be able to add the geopackage to QGIS and both <code>point</code> and <code>poly</code> will be recognised as valid layers.</p><p>That&rsquo;s it for part 1, next up we will go into some more advanced functionality, including triggers to automate logic with SQL that would otherwise be handled by scripting or using QGIS processing tools.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://joekbullard.github.io/tags/python/>python</a></li><li><a href=https://joekbullard.github.io/tags/geopackage/>geopackage</a></li></ul><nav class=paginav><a class=next href=https://joekbullard.github.io/posts/docker-geoserver-part-1/><span class=title>Next »</span><br><span>Docker Geoserver Part 1</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share GeoPackage and Python - Part 1 on twitter" href="https://twitter.com/intent/tweet/?text=GeoPackage%20and%20Python%20-%20Part%201&amp;url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fgeopackage-part-1%2f&amp;hashtags=python%2cgeopackage"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GeoPackage and Python - Part 1 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fgeopackage-part-1%2f&amp;title=GeoPackage%20and%20Python%20-%20Part%201&amp;summary=GeoPackage%20and%20Python%20-%20Part%201&amp;source=https%3a%2f%2fjoekbullard.github.io%2fposts%2fgeopackage-part-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share GeoPackage and Python - Part 1 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fgeopackage-part-1%2f&title=GeoPackage%20and%20Python%20-%20Part%201"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://joekbullard.github.io>Joe k Bullard</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>