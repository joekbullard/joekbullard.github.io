<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Geoserver Part 1 | joekbullard</title><meta name=keywords content><meta name=description content="This is the first in a small series that will go through the process of compiling an open source spatial stack to store, serve and visualise spatial data. Given we will be working with a number of containers it is beneficial to work with docker-compose.
Note: While it is possible to use Postgres in a docker container, this is not recommended for production purposes. A managed service such as AWS RDS is a better option in these instances."><meta name=author content="Me"><link rel=canonical href=https://joekbullard.github.io/posts/docker-geoserver-part-1/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b183800e2cfbb62c3bce2b2ba56cdb2dd33af76c75cf4550173d5dfebd7c68a6.css integrity="sha256-sYOADiz7tiw7zisrpWzbLdM692x1z0VQFz1d/r18aKY=" rel="preload stylesheet" as=style><link rel=icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Docker Geoserver Part 1"><meta property="og:description" content="This is the first in a small series that will go through the process of compiling an open source spatial stack to store, serve and visualise spatial data. Given we will be working with a number of containers it is beneficial to work with docker-compose.
Note: While it is possible to use Postgres in a docker container, this is not recommended for production purposes. A managed service such as AWS RDS is a better option in these instances."><meta property="og:type" content="article"><meta property="og:url" content="https://joekbullard.github.io/posts/docker-geoserver-part-1/"><meta property="og:image" content="https://joekbullard.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-21T01:22:15+00:00"><meta property="article:modified_time" content="2022-11-21T01:22:15+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://joekbullard.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker Geoserver Part 1"><meta name=twitter:description content="This is the first in a small series that will go through the process of compiling an open source spatial stack to store, serve and visualise spatial data. Given we will be working with a number of containers it is beneficial to work with docker-compose.
Note: While it is possible to use Postgres in a docker container, this is not recommended for production purposes. A managed service such as AWS RDS is a better option in these instances."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://joekbullard.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Docker Geoserver Part 1","item":"https://joekbullard.github.io/posts/docker-geoserver-part-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Geoserver Part 1","name":"Docker Geoserver Part 1","description":"This is the first in a small series that will go through the process of compiling an open source spatial stack to store, serve and visualise spatial data. Given we will be working with a number of containers it is beneficial to work with docker-compose.\nNote: While it is possible to use Postgres in a docker container, this is not recommended for production purposes. A managed service such as AWS RDS is a better option in these instances.","keywords":[],"articleBody":" This is the first in a small series that will go through the process of compiling an open source spatial stack to store, serve and visualise spatial data. Given we will be working with a number of containers it is beneficial to work with docker-compose.\nNote: While it is possible to use Postgres in a docker container, this is not recommended for production purposes. A managed service such as AWS RDS is a better option in these instances.\nPre-requisites:\nDocker Docker compose An IDE will also make things easier, I use VS Code myself. The applications themselves will be sorted by Docker images.\nThis article will focus on setting up and configuring a PostgreSQL database. Because we are working with spatial data, we will be using the kartoza postgis image.\nFirst, let’s make a new directory and navigate into it.\n$ mkdir open-stack \u0026\u0026 cd open-stack Now let’s set up a docker-compose file to start the process of building our services.\n$ touch docker-compose.yml Open the docker-compose.yml and enter the following:\nversion: '3.8' services: db: image: kartoza/postgis:14-3.1 volumes: - ./data/db:/var/lib/postgresql/data volumes: postgres_data: Let’s break this down line by line, version details the Compose file format, note that new versions of docker-compose require more current versions of Docker Engine. 3.8 is the most recent version but it’s possible to use older versions if you’re using an older version of Docker for whatever reason - you will just need to adjust this number accordingly.\nNext we define our services, at the moment we are only defining one service, db. Within this service we set our image to kartoza/postgis:14-3.1 - this is the image we will be using, we also configure a volume that will contain the data when the container is running.\nNow we have a docker-compose file set up, let’s test it out.\n$ docker-compose up Now you should run into a few errors here, this is because we haven’t configured any of the required environmental variables. The output from the terminal should give you some indication of what is required:\ndb_1 | Error: Database is uninitialized and superuser password is not specified. db_1 | You must specify POSTGRES_PASSWORD to a non-empty value for the db_1 | superuser. For example, \"-e POSTGRES_PASSWORD=password\" on \"docker run\". db_1 | db_1 | You may also use \"POSTGRES_HOST_AUTH_METHOD=trust\" to allow all db_1 | connections without a password. This is *not* recommended. db_1 | db_1 | See PostgreSQL documentation about \"trust\": db_1 | https://www.postgresql.org/docs/current/auth-trust.html So it’s clear we need to specify a password, in addition we will also set the superuser name, port and db name. To do that we could include these as raw strings in the docker-compose file, however, it’s considered better practice to use a .env file that contains the variables. So let’s create a .env file\n$ touch .env Open the .env file and configure the settings for the database, note you don’t have to use the settings below and are free to adjust accordingly.\nPOSTGRES_USER=postgres POSTGRES_PASSWORD=postgres DATABASE_DB=open_stack_db Now we need to adjust the docker-compose to include these variables. I have also included ALLOW_IP_RANGE as this allows connections from outside of the docker container, for example if you want to view the data within qgis.\nversion: '3.8' services: db: image: kartoza/postgis:14-3.1 env_file: - ./.env environment: - POSTGRES_DB=${DATABASE} - POSTGRES_USER=${POSTGRES_USER} - POSTGRES_PASS=${POSTGRES_PASSWORD} - ALLOW_IP_RANGE=0.0.0.0/0 volumes: - ./data/db:/var/lib/postgresql/data ports: - 5432:5432 volumes: postgres_data: Here we specify the location of our .env file. Now re-run the docker-compose:\n$ docker-compose down -v $ docker-compose up -d Note the -d flag, this is a shorthand for --detached which means the container runs in the background. The container should now start correctly, you can check this using docker container ls - your postgis container should be shown as running.\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES bfc0c956e446 postgis/postgis \"docker-entrypoint.s…\" 6 minutes ago Up 4 minutes 5432/tcp open-stack_db_1 We can also access the database container using psql:\n$ docker-compose exec db psql -U postgres -h localhost -d open_stack_db Once successful you should see the following:\nopen_stack_db=# Voila! We now have a database up and running. Now let’s get some spatial data into the database. There are a myriad of ways to get data into a database, for the purpose of development it is often beneficial to automate the process of importing at container start up. Fortunately this is quite a straightforward process using Docker.\nFirst we need some data, this can be pretty much anything. In this example I have used Bristol parks and green space sites from the Bristol open data portal. You can download as a shapefile then convert to a sql dump using ogr2ogr, something like this should work:\n$ ogr2ogr --config PG_USE_COPY YES -f PGDump bristol_green_space.sql parks-and-greens-spaces.shp -lco GEOMETRY_NAME=geom -nlt PROMOTE_TO_MULTI Once we have the sql dump of the data, we need to copy it into the project directory, it can either be in the project root or a given folder, it’s up to you. Next, all we have to do is add the following line to docker-compose under volumes within the db service:\nversion: '3.8' services: db: image: kartoza/postgis:14-3.1 env_file: # new - ./.env # new environment: - POSTGRES_DB=${DATABASE_DB} - POSTGRES_USER=${POSTGRES_USER} - POSTGRES_PASS=${POSTGRES_PASSWORD} - ALLOW_IP_RANGE=0.0.0.0/0 volumes: - ./data/db:/var/lib/postgresql/data - ./bristol_green_space.sql:/docker-entrypoint-initdb.d/bristol_green_space.sql ports: - 5432:5432 volumes: postgres_data: Basically any .sql file that is copied into /docker-entrypoint-initdb.d/ will be executed on startup, by providing relative path to our sql dump this will be mounted as a volume at start of the container. We can test this out by reconnecting to the database. First we need to run docker-compose again:\n$ docker-compose down -v $ docker-compose up -d Then access the database:\ndocker-compose exec db psql -U postgres -h localhost -d open_stack_db And finally, run the \\dt meta command:\nopen_stack_db=# \\dt List of relations Schema | Name | Type | Owner ----------+-------------------------+-------+---------- public | parks_and_greens_spaces | table | postgres public | spatial_ref_sys | table | postgres topology | layer | table | postgres topology | topology | table | postgres Great, we can see that the import was successful, that’s the end of this part of the process, next time we will be tackling GeoServer.\n","wordCount":"1018","inLanguage":"en","datePublished":"2022-11-21T01:22:15Z","dateModified":"2022-11-21T01:22:15Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://joekbullard.github.io/posts/docker-geoserver-part-1/"},"publisher":{"@type":"Organization","name":"joekbullard","logo":{"@type":"ImageObject","url":"https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://joekbullard.github.io accesskey=h title="Home (Alt + H)"><img src=https://joekbullard.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://joekbullard.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://joekbullard.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://joekbullard.xyz title=joekbullard.xyz><span>joekbullard.xyz</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://joekbullard.github.io>Home</a>&nbsp;»&nbsp;<a href=https://joekbullard.github.io/posts/>Posts</a></div><h1 class=post-title>Docker Geoserver Part 1</h1><div class=post-meta><span title='2022-11-21 01:22:15 +0000 UTC'>November 21, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1018 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/docker-geoserver-part-1.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p><img loading=lazy src=https://joekbullard-django-blog.s3.amazonaws.com/media/markdownx/bc55f853-76c7-4bcb-b0ea-a2ea590d0f8c.png alt="Docker logo"></p><p>This is the first in a small series that will go through the process of compiling an open source spatial stack to store, serve and visualise spatial data. Given we will be working with a number of containers it is beneficial to work with docker-compose.</p><p>Note: While it is possible to use Postgres in a docker container, this is not recommended for production purposes. A managed service such as AWS RDS is a better option in these instances.</p><p>Pre-requisites:</p><ul><li><a href=https://docs.docker.com/get-docker/>Docker</a></li><li><a href=https://docs.docker.com/compose/install/>Docker compose</a></li><li>An IDE will also make things easier, I use VS Code myself.</li></ul><p>The applications themselves will be sorted by Docker images.</p><p>This article will focus on setting up and configuring a PostgreSQL database. Because we are working with spatial data, we will be using the <a href=https://hub.docker.com/r/kartoza/postgis/>kartoza postgis image</a>.</p><p>First, let’s make a new directory and navigate into it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> mkdir open-stack <span class=o>&amp;&amp;</span> <span class=nb>cd</span> open-stack
</span></span></code></pre></div><p>Now let’s set up a docker-compose file to start the process of building our services.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> touch docker-compose.yml
</span></span></code></pre></div><p>Open the <code>docker-compose.yml</code> and enter the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=line><span class=cl>version: <span class=s1>&#39;3.8&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>services:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  db:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    image: kartoza/postgis:14-3.1<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    volumes:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - ./data/db:/var/lib/postgresql/data<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>volumes:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  postgres_data:<span class=err>
</span></span></span></code></pre></div><p>Let’s break this down line by line, <code>version</code> details the Compose file format, note that new versions of docker-compose require more current versions of Docker Engine. 3.8 is the most recent version but it’s possible to use older versions if you’re using an older version of Docker for whatever reason - you will just need to adjust this number accordingly.</p><p>Next we define our <code>services</code>, at the moment we are only defining one service, <code>db</code>. Within this service we set our image to <code>kartoza/postgis:14-3.1</code> - this is the image we will be using, we also configure a <code>volume</code> that will contain the data when the container is running.</p><p>Now we have a docker-compose file set up, let’s test it out.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> docker-compose up
</span></span></code></pre></div><p>Now you should run into a few errors here, this is because we haven’t configured any of the required environmental variables. The output from the terminal should give you some indication of what is required:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db_1  <span class=p>|</span> Error: Database is uninitialized and superuser password is not specified.
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span>        You must specify POSTGRES_PASSWORD to a non-empty value <span class=k>for</span> the
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span>        superuser. For example, <span class=s2>&#34;-e POSTGRES_PASSWORD=password&#34;</span> on <span class=s2>&#34;docker run&#34;</span>.
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span> 
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span>        You may also use <span class=s2>&#34;POSTGRES_HOST_AUTH_METHOD=trust&#34;</span> to allow all
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span>        connections without a password. This is *not* recommended.
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span> 
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span>        See PostgreSQL documentation about <span class=s2>&#34;trust&#34;</span>:
</span></span><span class=line><span class=cl>db_1  <span class=p>|</span>        https://www.postgresql.org/docs/current/auth-trust.html
</span></span></code></pre></div><p>So it’s clear we need to specify a password, in addition we will also set the superuser name, port and db name. To do that we could include these as raw strings in the docker-compose file, however, it’s considered better practice to use a .env file that contains the variables. So let’s create a .env file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ touch .env
</span></span></code></pre></div><p>Open the <code>.env</code> file and configure the settings for the database, note you don’t have to use the settings below and are free to adjust accordingly.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POSTGRES_USER=postgres
</span></span><span class=line><span class=cl>POSTGRES_PASSWORD=postgres
</span></span><span class=line><span class=cl>DATABASE_DB=open_stack_db
</span></span></code></pre></div><p>Now we need to adjust the docker-compose to include these variables. I have also included <code>ALLOW_IP_RANGE</code> as this allows connections from outside of the docker container, for example if you want to view the data within qgis.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=line><span class=cl>version: <span class=s1>&#39;3.8&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>services:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  db:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    image: kartoza/postgis:14-3.1<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    env_file:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - ./.env<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    environment:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>POSTGRES_DB</span><span class=o>=</span><span class=si>${</span><span class=nv>DATABASE</span><span class=si>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>POSTGRES_USER</span><span class=o>=</span><span class=si>${</span><span class=nv>POSTGRES_USER</span><span class=si>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>POSTGRES_PASS</span><span class=o>=</span><span class=si>${</span><span class=nv>POSTGRES_PASSWORD</span><span class=si>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>ALLOW_IP_RANGE</span><span class=o>=</span>0.0.0.0/0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    volumes:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - ./data/db:/var/lib/postgresql/data<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    ports:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - 5432:5432<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>volumes:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  postgres_data:<span class=err>
</span></span></span></code></pre></div><p>Here we specify the location of our .env file. Now re-run the docker-compose:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ docker-compose down -v
</span></span><span class=line><span class=cl>$ docker-compose up -d
</span></span></code></pre></div><p>Note the <code>-d</code> flag, this is a shorthand for <code>--detached</code> which means the container runs in the background. The container should now start correctly, you can check this using <code>docker container ls</code> - your postgis container should be shown as running.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>CONTAINER ID   IMAGE             COMMAND                  CREATED         STATUS         PORTS      NAMES
</span></span><span class=line><span class=cl>bfc0c956e446   postgis/postgis   <span class=s2>&#34;docker-entrypoint.s…&#34;</span>   <span class=m>6</span> minutes ago   Up <span class=m>4</span> minutes   5432/tcp   open-stack_db_1
</span></span></code></pre></div><p>We can also access the database container using psql:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ docker-compose <span class=nb>exec</span> db psql -U postgres -h localhost -d open_stack_db
</span></span></code></pre></div><p>Once successful you should see the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>open_stack_db=# 
</span></span></code></pre></div><p>Voila! We now have a database up and running. Now let’s get some spatial data into the database. There are a myriad of ways to get data into a database, for the purpose of development it is often beneficial to automate the process of importing at container start up. Fortunately this is quite a straightforward process using Docker.</p><p>First we need some data, this can be pretty much anything. In this example I have used <a href="https://opendata.bristol.gov.uk/explore/dataset/parks-and-greens-spaces/table/?location=13,51.49672,-2.5781&basemap=jawg.streets">Bristol parks and green space sites</a> from the Bristol open data portal. You can download as a shapefile then convert to a sql dump
using ogr2ogr, something like this should work:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ogr2ogr --config PG_USE_COPY YES -f PGDump bristol_green_space.sql parks-and-greens-spaces.shp -lco <span class=nv>GEOMETRY_NAME</span><span class=o>=</span>geom -nlt PROMOTE_TO_MULTI
</span></span></code></pre></div><p>Once we have the sql dump of the data, we need to copy it into the project directory, it can either be in the project root or a given folder, it’s up to you. Next, all we have to do is add the following line to docker-compose under <code>volumes</code> within the db service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=line><span class=cl>version: <span class=s1>&#39;3.8&#39;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>services:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  db:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    image: kartoza/postgis:14-3.1<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    env_file: <span class=c1># new</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - ./.env <span class=c1># new</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    environment:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>POSTGRES_DB</span><span class=o>=</span><span class=si>${</span><span class=nv>DATABASE_DB</span><span class=si>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>POSTGRES_USER</span><span class=o>=</span><span class=si>${</span><span class=nv>POSTGRES_USER</span><span class=si>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>POSTGRES_PASS</span><span class=o>=</span><span class=si>${</span><span class=nv>POSTGRES_PASSWORD</span><span class=si>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - <span class=nv>ALLOW_IP_RANGE</span><span class=o>=</span>0.0.0.0/0<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    volumes:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - ./data/db:/var/lib/postgresql/data<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - ./bristol_green_space.sql:/docker-entrypoint-initdb.d/bristol_green_space.sql<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    ports:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      - 5432:5432<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>volumes:<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  postgres_data:<span class=err>
</span></span></span></code></pre></div><p>Basically any .sql file that is copied into <code>/docker-entrypoint-initdb.d/</code> will be executed on startup, by providing relative path to our sql dump this will be mounted as a volume at start of the container. We can test this out by reconnecting to the database. First we need to run docker-compose again:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> docker-compose down -v
</span></span><span class=line><span class=cl><span class=gp>$</span> docker-compose up -d
</span></span></code></pre></div><p>Then access the database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker-compose <span class=nb>exec</span> db psql -U postgres -h localhost -d open_stack_db
</span></span></code></pre></div><p>And finally, run the <code>\dt</code> meta command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>open_stack_db=# \dt
</span></span><span class=line><span class=cl>                   List of relations
</span></span><span class=line><span class=cl>  Schema  |          Name           | Type  |  Owner   
</span></span><span class=line><span class=cl>----------+-------------------------+-------+----------
</span></span><span class=line><span class=cl> public   | parks_and_greens_spaces | table | postgres
</span></span><span class=line><span class=cl> public   | spatial_ref_sys         | table | postgres
</span></span><span class=line><span class=cl> topology | layer                   | table | postgres
</span></span><span class=line><span class=cl> topology | topology                | table | postgres
</span></span></code></pre></div><p>Great, we can see that the import was successful, that&rsquo;s the end of this part of the process, next time we will be tackling GeoServer.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://joekbullard.github.io/posts/subdivide-and-conquer/><span class=title>Next »</span><br><span>Subdivide and Conquer</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Docker Geoserver Part 1 on twitter" href="https://twitter.com/intent/tweet/?text=Docker%20Geoserver%20Part%201&url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fdocker-geoserver-part-1%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Geoserver Part 1 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fdocker-geoserver-part-1%2f&title=Docker%20Geoserver%20Part%201&summary=Docker%20Geoserver%20Part%201&source=https%3a%2f%2fjoekbullard.github.io%2fposts%2fdocker-geoserver-part-1%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Docker Geoserver Part 1 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fdocker-geoserver-part-1%2f&title=Docker%20Geoserver%20Part%201"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://joekbullard.github.io>joekbullard</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>