<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>An Intro to Geopackage | Joe k Bullard</title><meta name=keywords content="python,geoackage,gdal"><meta name=description content="Geopackage is a format that will be familiar to many who work with spatial data, particularly those that use QGIS. In the majority of use cases it will be treated as little more than a shapefile replacement - i.e. a means to manage and share vector data. But what if I told you that by using a geopackage you could have access to a whole range of additional features and functionality more typically associated with a relational database management system (RDMS) like PostgreSQL/PostGIS?"><meta name=author content="Me"><link rel=canonical href=https://joekbullard.github.io/posts/an-intro-to-geopackage/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.89903f5336eff9763209fb4cd1e860a14715773bf5fd93b39c714e2690162751.css integrity="sha256-iZA/Uzbv+XYyCftM0ehgoUcVdzv1/ZOznHFOJpAWJ1E=" rel="preload stylesheet" as=style><link rel=icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="An Intro to Geopackage"><meta property="og:description" content="Geopackage is a format that will be familiar to many who work with spatial data, particularly those that use QGIS. In the majority of use cases it will be treated as little more than a shapefile replacement - i.e. a means to manage and share vector data. But what if I told you that by using a geopackage you could have access to a whole range of additional features and functionality more typically associated with a relational database management system (RDMS) like PostgreSQL/PostGIS?"><meta property="og:type" content="article"><meta property="og:url" content="https://joekbullard.github.io/posts/an-intro-to-geopackage/"><meta property="og:image" content="https://joekbullard.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-23T08:32:20+00:00"><meta property="article:modified_time" content="2023-03-23T08:32:20+00:00"><meta property="og:site_name" content="JoeKBullrd"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://joekbullard.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="An Intro to Geopackage"><meta name=twitter:description content="Geopackage is a format that will be familiar to many who work with spatial data, particularly those that use QGIS. In the majority of use cases it will be treated as little more than a shapefile replacement - i.e. a means to manage and share vector data. But what if I told you that by using a geopackage you could have access to a whole range of additional features and functionality more typically associated with a relational database management system (RDMS) like PostgreSQL/PostGIS?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://joekbullard.github.io/posts/"},{"@type":"ListItem","position":3,"name":"An Intro to Geopackage","item":"https://joekbullard.github.io/posts/an-intro-to-geopackage/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"An Intro to Geopackage","name":"An Intro to Geopackage","description":"Geopackage is a format that will be familiar to many who work with spatial data, particularly those that use QGIS. In the majority of use cases it will be treated as little more than a shapefile replacement - i.e. a means to manage and share vector data. But what if I told you that by using a geopackage you could have access to a whole range of additional features and functionality more typically associated with a relational database management system (RDMS) like PostgreSQL/PostGIS?","keywords":["python","geoackage","gdal"],"articleBody":"Geopackage is a format that will be familiar to many who work with spatial data, particularly those that use QGIS. In the majority of use cases it will be treated as little more than a shapefile replacement - i.e. a means to manage and share vector data. But what if I told you that by using a geopackage you could have access to a whole range of additional features and functionality more typically associated with a relational database management system (RDMS) like PostgreSQL/PostGIS? In this three part series we will go on a deep dive into some of the finer details of geopackage - but first lets start with the fundemental question - what is a GeoPackage?\nWhat is a geopackage? The geopackage format is simply a container for the ubiquitous SQLite file format. What is SQLite? Well, quoting sqlite.org:\nSQLite is a C-language library that implements a small, fast, self-contained, high-reliability, full-featured, SQL database engine.\nIn simple terms, SQLite is a SQL database engine contained within a single file - geopackage builds on this through the implementation of a standard that allows users to store spatial data. A key point here - unlike the shapefile, which many compare it to, geoackage is not just limited to vector (points, lines, polygons) data, but also raster - more on that later. In addition, it also incldes a suite of spatial functions. To better understand what a geoackage is, let’s create one and have a look around.\nMaking a GeoPackage For this part we will use the python GDAL library to generate a geopackage with a few different vector tables. For those not aware, GDAL, or Geospatial Data Abstraction Library, is the swiss army knife of dealing with geospatial data formats, allowing you to convert raster and vector data between hundreds of formats. If you’ve not used the python bindings before - there’s a bit of a learning curve but there are some good resources out there - notably this Cookbook.\nNote - Depending on your OS, GDAL can be tricky to install - the easiest way is probably to use Conda, if you just want to run the script below you can also just do so using the QGIS python console.\nUsing this script below, we will create an empty geopackage in the current directory called sample.gpkg.\nfrom osgeo import ogr filename = './sample.gpkg' driver = ogr.GetDriverByName('GPKG') data_source = driver.CreateDataSource(filename) data_source = None As a geopackage is an extension of sqlite, we can inspect it using the sqlite3 command line shell and .tables command (if you want you could also connect to the geopackage using the dbmanager in QGIS).\nsqlite3 sample.gpkg sqlite\u003e .tables gpkg_contents gpkg_ogr_contents gpkg_tile_matrix gpkg_geometry_columns gpkg_spatial_ref_sys gpkg_tile_matrix_set You will see there are six tables included in the geopackage, for now we will focus on gpkg_contents, gpkg_geometry_columns and gpkg_spatial_ref_sys - each of which is summarised below.\ngpkg_contents This table does more or less what you would expect given the name, it’s a contents table for a given GeoPackage that lists all geometry tables. A full specification can be seen on the table definition on geopackage.org. If you were to query this table now:\nsqlite\u003e select * from gpkg_contents; It will not return anything, as we don’t yet have any spatial tables in the geopackage.\ngpkg_spatial_ref_sys Much like gpkg_contents, I’m sure you can hazard a guess as to what you this table contains. If you guessed coordinate/spatial reference systems, then well done. Note that by default this table contains 3 rows - 4326, -1 for undefined Cartesian CRS’s and 0 for undefined geographic CRS’s, if you wish to work with a CRS other than 4326 then you will need to add it to this table.\nYou can take a look at the default rows:\nsqlite\u003e select srs_name from gpkg_spatial_ref_sys; Undefined Cartesian SRS Undefined geographic SRS WGS 84 geodetic gpkg_geometry_columns Lastly - gpkg_geometry_columns contains metadata relating to the geometry column for a given spatial table - including geometry type and CRS. As with gpkg_contents, this will currently be empty.\nAdding tables So now let’s try adding some spatial tables to the geopackage we just made.\nfrom osgeo import ogr, osr filename = './sample.gpkg' driver = ogr.GetDriverByName('GPKG') srs = osr.SpatialReference() srs.ImportFromEPSG(27700) data_source = driver.Open(filename, 1) point_layer = data_source.CreateLayer(\"points\", srs, ogr.wkbPoint) line_layer = data_source.CreateLayer(\"lines\", srs, ogr.wkbLineString) poly_layer = data_source.CreateLayer(\"polygons\", srs, ogr.wkbPolygon) data_source = None Above we have created three spatial tables, points, lines and polygons, each of which is projected as EPSG:27700 or Britsh National Grid. We can again inspect the geopackage using the sqlite3:\nsqlite3 sample.gpkg sqlite\u003e .tables gpkg_contents rtree_lines_geom_node gpkg_extensions rtree_lines_geom_parent gpkg_geometry_columns rtree_lines_geom_rowid gpkg_ogr_contents rtree_points_geom gpkg_spatial_ref_sys rtree_points_geom_node gpkg_tile_matrix rtree_points_geom_parent gpkg_tile_matrix_set rtree_points_geom_rowid lines rtree_polygons_geom points rtree_polygons_geom_node polygons rtree_polygons_geom_parent rtree_lines_geom rtree_polygons_geom_rowid Now we can see there are a significantly greater number of tables. In addition to the three we just created, there are a number of rtree tables - what are they? R-trees are data structures based on the concept of trees that are widely used within spatial databases and GIS to index multi-dimensional data. Within SQLite, R-trees are implemented by the rtree module. Each parent node represents a bounding box enclosing a set of child objects, this pattern is repeated down to the leaf nodes that contain the actual data. In short, R-trees enable efficient range queries, nearest neighbour searches and spatial joins - but realistically, you will probably never need to worry yourself about them.\nA quick note, while you can connect to a geopackage using sqlite3 and create tables with DDL commands directly, you will end up needing to manually add to the geopckage metadata tables and generate R-Trees - it’s therefore much easier to use ogr which undertakes many of the steps for you.\nAdding data to tables Let’s try populating our tables with some sample data.\nfrom osgeo import ogr filename = './sample.gpkg' driver = ogr.GetDriverByName('GPKG') data_source = driver.Open(filename, 1) point_layer = data_source.GetLayerByName('points') line_layer = data_source.GetLayerByName('lines') poly_layer = data_source.GetLayerByName('polygons') feature = ogr.Feature(point_layer.GetLayerDefn()) point = ogr.Geometry(ogr.wkbPoint) point.AddPoint(358776, 172559) feature.SetGeometry(point) point_layer.CreateFeature(feature) feature = None feature = ogr.Feature(line_layer.GetLayerDefn()) line = ogr.Geometry(ogr.wkbLineString) line.AddPoint(356204, 175408) line.AddPoint(361514, 171273) feature.SetGeometry(line) line_layer.CreateFeature(feature) feature = None feature = ogr.Feature(poly_layer.GetLayerDefn()) ring = ogr.Geometry(ogr.wkbLinearRing) ring.AddPoint(356540, 170849) ring.AddPoint(359257, 176251) ring.AddPoint(363364, 173020) ring.AddPoint(356540, 170849) polygon = ogr.Geometry(ogr.wkbPolygon) polygon.AddGeometry(ring) feature.SetGeometry(polygon) poly_layer.CreateFeature(feature) feature = None data_source = None While this may look like a lot, all it’s doing is creating a geometry feature for each of the tables we created - try opening the data in QGIS. We can now inspect the tables using sqlite3\nsqlite3 sample.gpkg sqlite\u003e select AsText(CastAutomagic(geom))as geom from points; geom -------------------- POINT(358776 172559) One additonal thing to note - we can inspect the gpkg_contents table.\nsqlite\u003e select * from gpkg_contents; table_name data_type identifier description last_change min_x min_y max_x max_y srs_id ---------- --------- ---------- ----------- ------------------------ -------- -------- -------- -------- ------ points features points 2023-03-23T19:26:10.493Z 358776.0 172559.0 358776.0 172559.0 27700 lines features lines 2023-03-23T19:26:10.506Z 356204.0 171273.0 361514.0 175408.0 27700 polygons features polygons 2023-03-23T19:26:10.516Z 356540.0 170849.0 363364.0 176251.0 27700 You can see that the min_x, min_y, max_x and max_y have all adjusted automatically inline with the extents of the new features.\nThat’s probably enough of an introduction to geopackage, in the next part we will look into how we can leverage procedures like TRIGGER to move spatial processing logic from desktop GIS into the geopackage as well as how we can integrate this into QGIS projects.\n","wordCount":"1214","inLanguage":"en","datePublished":"2023-03-23T08:32:20Z","dateModified":"2023-03-23T08:32:20Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://joekbullard.github.io/posts/an-intro-to-geopackage/"},"publisher":{"@type":"Organization","name":"Joe k Bullard","logo":{"@type":"ImageObject","url":"https://joekbullard.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://joekbullard.github.io accesskey=h title="Home (Alt + H)"><img src=https://joekbullard.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://joekbullard.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://joekbullard.xyz title=joekbullard.xyz><span>joekbullard.xyz</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://joekbullard.github.io>Home</a>&nbsp;»&nbsp;<a href=https://joekbullard.github.io/posts/>Posts</a></div><h1 class=post-title>An Intro to Geopackage</h1><div class=post-meta><span title='2023-03-23 08:32:20 +0000 UTC'>March 23, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1214 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/joekbullard/joekbullard.github.io/tree/main/content/posts/an-intro-to-geopackage.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Geopackage is a format that will be familiar to many who work with spatial data, particularly those that use QGIS. In the majority of use cases it will be treated as little more than a shapefile replacement - i.e. a means to manage and share vector data. But what if I told you that by using a geopackage you could have access to a whole range of additional features and functionality more typically associated with a relational database management system (RDMS) like PostgreSQL/PostGIS? In this three part series we will go on a deep dive into some of the finer details of geopackage - but first lets start with the fundemental question - what is a GeoPackage?</p><h2 id=what-is-a-geopackage>What is a geopackage?<a hidden class=anchor aria-hidden=true href=#what-is-a-geopackage>#</a></h2><p>The geopackage format is simply a container for the ubiquitous SQLite file format. What is SQLite? Well, quoting <a href=https://sqlite.org/index.html>sqlite.org</a>:</p><blockquote><p><em>SQLite is a C-language library that implements a small, fast, self-contained, high-reliability, full-featured, SQL database engine.</em></p></blockquote><p>In simple terms, SQLite is a SQL database engine contained within a single file - geopackage builds on this through the implementation of a standard that allows users to store spatial data. A key point here - unlike the shapefile, which many compare it to, geoackage is not just limited to vector (points, lines, polygons) data, but also raster - more on that later. In addition, it also incldes a suite of spatial functions. To better understand what a geoackage is, let&rsquo;s create one and have a look around.</p><h2 id=making-a-geopackage>Making a GeoPackage<a hidden class=anchor aria-hidden=true href=#making-a-geopackage>#</a></h2><p>For this part we will use the python GDAL library to generate a geopackage with a few different vector tables. For those not aware, <a href=https://gdal.org/>GDAL</a>, or Geospatial Data Abstraction Library, is the swiss army knife of dealing with geospatial data formats, allowing you to convert raster and vector data between hundreds of formats. If you&rsquo;ve not used the python bindings before - there&rsquo;s a bit of a learning curve but there are some good resources out there - notably <a href=https://pcjericks.github.io/py-gdalogr-cookbook/index.html>this Cookbook</a>.</p><p><strong>Note</strong> - Depending on your OS, GDAL can be tricky to install - the easiest way is probably to <a href=https://opensourceoptions.com/blog/how-to-install-gdal-with-anaconda/>use Conda</a>, if you just want to run the script below you can also just do so using the QGIS python console.</p><p>Using this script below, we will create an empty geopackage in the current directory called <code>sample.gpkg</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>osgeo</span> <span class=kn>import</span> <span class=n>ogr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s1>&#39;./sample.gpkg&#39;</span>
</span></span><span class=line><span class=cl><span class=n>driver</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>GetDriverByName</span><span class=p>(</span><span class=s1>&#39;GPKG&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>CreateDataSource</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></div><p>As a geopackage is an extension of sqlite, we can inspect it using the <code>sqlite3</code> command line shell and <code>.tables</code> command (if you want you could also connect to the geopackage using the dbmanager in QGIS).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlite3 sample.gpkg
</span></span><span class=line><span class=cl>sqlite&gt; .tables
</span></span><span class=line><span class=cl>gpkg_contents          gpkg_ogr_contents      gpkg_tile_matrix     
</span></span><span class=line><span class=cl>gpkg_geometry_columns  gpkg_spatial_ref_sys   gpkg_tile_matrix_set
</span></span></code></pre></div><p>You will see there are six tables included in the geopackage, for now we will focus on <code>gpkg_contents</code>, <code>gpkg_geometry_columns</code> and <code>gpkg_spatial_ref_sys</code> - each of which is summarised below.</p><h3 id=gpkg_contents><code>gpkg_contents</code><a hidden class=anchor aria-hidden=true href=#gpkg_contents>#</a></h3><p>This table does more or less what you would expect given the name, it&rsquo;s a contents table for a given GeoPackage that lists all geometry tables. A full specification can be seen on the <a href=http://www.geopackage.org/spec120/#_contents>table definition on geopackage.org</a>. If you were to query this table now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> * from gpkg_contents<span class=p>;</span>
</span></span></code></pre></div><p>It will not return anything, as we don&rsquo;t yet have any spatial tables in the geopackage.</p><h3 id=gpkg_spatial_ref_sys><code>gpkg_spatial_ref_sys</code><a hidden class=anchor aria-hidden=true href=#gpkg_spatial_ref_sys>#</a></h3><p>Much like <code>gpkg_contents</code>, I&rsquo;m sure you can hazard a guess as to what you this table contains. If you guessed coordinate/spatial reference systems, then well done. Note that by default this table contains 3 rows - 4326, -1 for undefined Cartesian CRS&rsquo;s and 0 for undefined geographic CRS&rsquo;s, if you wish to work with a CRS other than 4326 then you will need to add it to this table.</p><p>You can take a look at the default rows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> srs_name from gpkg_spatial_ref_sys<span class=p>;</span>
</span></span><span class=line><span class=cl>Undefined Cartesian SRS
</span></span><span class=line><span class=cl>Undefined geographic SRS
</span></span><span class=line><span class=cl>WGS <span class=m>84</span> geodetic
</span></span></code></pre></div><h3 id=gpkg_geometry_columns><code>gpkg_geometry_columns</code><a hidden class=anchor aria-hidden=true href=#gpkg_geometry_columns>#</a></h3><p>Lastly - <code>gpkg_geometry_columns</code> contains metadata relating to the geometry column for a given spatial table - including geometry type and CRS. As with <code>gpkg_contents</code>, this will currently be empty.</p><h2 id=adding-tables>Adding tables<a hidden class=anchor aria-hidden=true href=#adding-tables>#</a></h2><p>So now let&rsquo;s try adding some spatial tables to the geopackage we just made.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>osgeo</span> <span class=kn>import</span> <span class=n>ogr</span><span class=p>,</span> <span class=n>osr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s1>&#39;./sample.gpkg&#39;</span>
</span></span><span class=line><span class=cl><span class=n>driver</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>GetDriverByName</span><span class=p>(</span><span class=s1>&#39;GPKG&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>srs</span> <span class=o>=</span> <span class=n>osr</span><span class=o>.</span><span class=n>SpatialReference</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>srs</span><span class=o>.</span><span class=n>ImportFromEPSG</span><span class=p>(</span><span class=mi>27700</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>Open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>point_layer</span> <span class=o>=</span> <span class=n>data_source</span><span class=o>.</span><span class=n>CreateLayer</span><span class=p>(</span><span class=s2>&#34;points&#34;</span><span class=p>,</span> <span class=n>srs</span><span class=p>,</span> <span class=n>ogr</span><span class=o>.</span><span class=n>wkbPoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>line_layer</span> <span class=o>=</span> <span class=n>data_source</span><span class=o>.</span><span class=n>CreateLayer</span><span class=p>(</span><span class=s2>&#34;lines&#34;</span><span class=p>,</span> <span class=n>srs</span><span class=p>,</span> <span class=n>ogr</span><span class=o>.</span><span class=n>wkbLineString</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>poly_layer</span> <span class=o>=</span> <span class=n>data_source</span><span class=o>.</span><span class=n>CreateLayer</span><span class=p>(</span><span class=s2>&#34;polygons&#34;</span><span class=p>,</span> <span class=n>srs</span><span class=p>,</span> <span class=n>ogr</span><span class=o>.</span><span class=n>wkbPolygon</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></div><p>Above we have created three spatial tables, <code>points</code>, <code>lines</code> and <code>polygons</code>, each of which is projected as EPSG:27700 or Britsh National Grid. We can again inspect the geopackage using the <code>sqlite3</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>sqlite3 sample.gpkg
</span></span><span class=line><span class=cl>sqlite&gt; .tables
</span></span><span class=line><span class=cl>gpkg_contents               rtree_lines_geom_node     
</span></span><span class=line><span class=cl>gpkg_extensions             rtree_lines_geom_parent   
</span></span><span class=line><span class=cl>gpkg_geometry_columns       rtree_lines_geom_rowid    
</span></span><span class=line><span class=cl>gpkg_ogr_contents           rtree_points_geom         
</span></span><span class=line><span class=cl>gpkg_spatial_ref_sys        rtree_points_geom_node    
</span></span><span class=line><span class=cl>gpkg_tile_matrix            rtree_points_geom_parent  
</span></span><span class=line><span class=cl>gpkg_tile_matrix_set        rtree_points_geom_rowid   
</span></span><span class=line><span class=cl>lines                       rtree_polygons_geom       
</span></span><span class=line><span class=cl>points                      rtree_polygons_geom_node  
</span></span><span class=line><span class=cl>polygons                    rtree_polygons_geom_parent
</span></span><span class=line><span class=cl>rtree_lines_geom            rtree_polygons_geom_rowid 
</span></span></code></pre></div><p>Now we can see there are a significantly greater number of tables. In addition to the three we just created, there are a number of <code>rtree</code> tables - what are they? R-trees are data structures based on the concept of trees that are widely used within spatial databases and GIS to index multi-dimensional data. Within SQLite, R-trees are implemented by the <a href=https://www.sqlite.org/rtree.html>rtree module</a>. Each parent node represents a bounding box enclosing a set of child objects, this pattern is repeated down to the leaf nodes that contain the actual data. In short, R-trees enable efficient range queries, nearest neighbour searches and spatial joins - but realistically, you will probably never need to worry yourself about them.</p><p>A quick note, while you can connect to a geopackage using <code>sqlite3</code> and create tables with DDL commands directly, you will end up needing to manually add to the geopckage metadata tables and generate R-Trees - it&rsquo;s therefore much easier to use <code>ogr</code> which undertakes many of the steps for you.</p><h2 id=adding-data-to-tables>Adding data to tables<a hidden class=anchor aria-hidden=true href=#adding-data-to-tables>#</a></h2><p>Let&rsquo;s try populating our tables with some sample data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>osgeo</span> <span class=kn>import</span> <span class=n>ogr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>filename</span> <span class=o>=</span> <span class=s1>&#39;./sample.gpkg&#39;</span>
</span></span><span class=line><span class=cl><span class=n>driver</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>GetDriverByName</span><span class=p>(</span><span class=s1>&#39;GPKG&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=n>driver</span><span class=o>.</span><span class=n>Open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>point_layer</span> <span class=o>=</span> <span class=n>data_source</span><span class=o>.</span><span class=n>GetLayerByName</span><span class=p>(</span><span class=s1>&#39;points&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>line_layer</span> <span class=o>=</span> <span class=n>data_source</span><span class=o>.</span><span class=n>GetLayerByName</span><span class=p>(</span><span class=s1>&#39;lines&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>poly_layer</span> <span class=o>=</span> <span class=n>data_source</span><span class=o>.</span><span class=n>GetLayerByName</span><span class=p>(</span><span class=s1>&#39;polygons&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>feature</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Feature</span><span class=p>(</span><span class=n>point_layer</span><span class=o>.</span><span class=n>GetLayerDefn</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>point</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Geometry</span><span class=p>(</span><span class=n>ogr</span><span class=o>.</span><span class=n>wkbPoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>point</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>358776</span><span class=p>,</span> <span class=mi>172559</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>feature</span><span class=o>.</span><span class=n>SetGeometry</span><span class=p>(</span><span class=n>point</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>point_layer</span><span class=o>.</span><span class=n>CreateFeature</span><span class=p>(</span><span class=n>feature</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>feature</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>feature</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Feature</span><span class=p>(</span><span class=n>line_layer</span><span class=o>.</span><span class=n>GetLayerDefn</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>line</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Geometry</span><span class=p>(</span><span class=n>ogr</span><span class=o>.</span><span class=n>wkbLineString</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>line</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>356204</span><span class=p>,</span> <span class=mi>175408</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>line</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>361514</span><span class=p>,</span> <span class=mi>171273</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>feature</span><span class=o>.</span><span class=n>SetGeometry</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>line_layer</span><span class=o>.</span><span class=n>CreateFeature</span><span class=p>(</span><span class=n>feature</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>feature</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>feature</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Feature</span><span class=p>(</span><span class=n>poly_layer</span><span class=o>.</span><span class=n>GetLayerDefn</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>ring</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Geometry</span><span class=p>(</span><span class=n>ogr</span><span class=o>.</span><span class=n>wkbLinearRing</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ring</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>356540</span><span class=p>,</span> <span class=mi>170849</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ring</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>359257</span><span class=p>,</span> <span class=mi>176251</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ring</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>363364</span><span class=p>,</span> <span class=mi>173020</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ring</span><span class=o>.</span><span class=n>AddPoint</span><span class=p>(</span><span class=mi>356540</span><span class=p>,</span> <span class=mi>170849</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>polygon</span> <span class=o>=</span> <span class=n>ogr</span><span class=o>.</span><span class=n>Geometry</span><span class=p>(</span><span class=n>ogr</span><span class=o>.</span><span class=n>wkbPolygon</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>polygon</span><span class=o>.</span><span class=n>AddGeometry</span><span class=p>(</span><span class=n>ring</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>feature</span><span class=o>.</span><span class=n>SetGeometry</span><span class=p>(</span><span class=n>polygon</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>poly_layer</span><span class=o>.</span><span class=n>CreateFeature</span><span class=p>(</span><span class=n>feature</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>feature</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data_source</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></div><p>While this may look like a lot, all it&rsquo;s doing is creating a geometry feature for each of the tables we created - try opening the data in QGIS. We can now inspect the tables using <code>sqlite3</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>sqlite3 sample.gpkg
</span></span><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> AsText<span class=o>(</span>CastAutomagic<span class=o>(</span>geom<span class=o>))</span>as geom from points<span class=p>;</span>
</span></span><span class=line><span class=cl>geom                
</span></span><span class=line><span class=cl>--------------------
</span></span><span class=line><span class=cl>POINT<span class=o>(</span><span class=m>358776</span> 172559<span class=o>)</span>
</span></span></code></pre></div><p>One additonal thing to note - we can inspect the <code>gpkg_contents</code> table.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> * from gpkg_contents<span class=p>;</span>
</span></span><span class=line><span class=cl>table_name  data_type  identifier  description  last_change               min_x     min_y     max_x     max_y     srs_id
</span></span><span class=line><span class=cl>----------  ---------  ----------  -----------  ------------------------  --------  --------  --------  --------  ------
</span></span><span class=line><span class=cl>points      features   points                   2023-03-23T19:26:10.493Z  358776.0  172559.0  358776.0  172559.0  <span class=m>27700</span> 
</span></span><span class=line><span class=cl>lines       features   lines                    2023-03-23T19:26:10.506Z  356204.0  171273.0  361514.0  175408.0  <span class=m>27700</span> 
</span></span><span class=line><span class=cl>polygons    features   polygons                 2023-03-23T19:26:10.516Z  356540.0  170849.0  363364.0  176251.0  <span class=m>27700</span> 
</span></span></code></pre></div><p>You can see that the <code>min_x</code>, <code>min_y</code>, <code>max_x</code> and <code>max_y</code> have all adjusted automatically inline with the extents of the new features.</p><p>That&rsquo;s probably enough of an introduction to geopackage, in the next part we will look into how we can leverage procedures like <code>TRIGGER</code> to move spatial processing logic from desktop GIS into the geopackage as well as how we can integrate this into QGIS projects.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://joekbullard.github.io/tags/python/>python</a></li><li><a href=https://joekbullard.github.io/tags/geoackage/>geoackage</a></li><li><a href=https://joekbullard.github.io/tags/gdal/>gdal</a></li></ul><nav class=paginav><a class=prev href=https://joekbullard.github.io/posts/docker-gdal/><span class=title>« Prev</span><br><span>Using docker with Gdal</span></a>
<a class=next href=https://joekbullard.github.io/posts/docker-geoserver-part-1/><span class=title>Next »</span><br><span>Docker Geoserver Part 1</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share An Intro to Geopackage on twitter" href="https://twitter.com/intent/tweet/?text=An%20Intro%20to%20Geopackage&amp;url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fan-intro-to-geopackage%2f&amp;hashtags=python%2cgeoackage%2cgdal"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share An Intro to Geopackage on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fan-intro-to-geopackage%2f&amp;title=An%20Intro%20to%20Geopackage&amp;summary=An%20Intro%20to%20Geopackage&amp;source=https%3a%2f%2fjoekbullard.github.io%2fposts%2fan-intro-to-geopackage%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share An Intro to Geopackage on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjoekbullard.github.io%2fposts%2fan-intro-to-geopackage%2f&title=An%20Intro%20to%20Geopackage"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://joekbullard.github.io>Joe k Bullard</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>